/*!
 * jQuery clueTip plugin v1.2
 *
 * Date: Sun Jul 17 14:40:23 2011 EDT
 * Requires: jQuery v1.3+
 *
 * Copyright 2011, Karl Swedberg
 * Dual licensed under the MIT and GPL licenses:
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl.html
 *
 *
 * Examples can be found at http://plugins.learningjquery.com/cluetip/demo/
 *
*/
(function(c){c.cluetip={version:"1.2",template:'<div><div class="cluetip-outer"><h3 class="cluetip-title ui-widget-header ui-cluetip-header"></h3><div class="cluetip-inner ui-widget-content ui-cluetip-content"></div></div><div class="cluetip-extra"></div><div class="cluetip-arrows ui-state-default"></div></div>',setup:{insertionType:"appendTo",insertionElement:"body"},defaults:{width:275,height:"auto",cluezIndex:97,positionBy:"auto",topOffset:15,leftOffset:15,local:false,localPrefix:null,localIdSuffix:null,
hideLocal:true,attribute:"rel",titleAttribute:"title",splitTitle:"",escapeTitle:false,showTitle:true,cluetipClass:"default",hoverClass:"",waitImage:true,cursor:"help",arrows:false,dropShadow:true,dropShadowSteps:6,sticky:false,mouseOutClose:false,activation:"hover",clickThrough:true,tracking:false,delayedClose:0,closePosition:"top",closeText:"Close",truncate:0,fx:{open:"show",openSpeed:""},hoverIntent:{sensitivity:3,interval:50,timeout:0},onActivate:function(){return true},onShow:function(){},onHide:function(){},
ajaxCache:true,ajaxProcess:function(j){return j=j.replace(/<(script|style|title)[^<]+<\/(script|style|title)>/gm,"").replace(/<(link|meta)[^>]+>/g,"")},ajaxSettings:{dataType:"html"},debug:false}};var B,ca=0,L=0;c.fn.attrProp=c.fn.prop||c.fn.attr;c.fn.cluetip=function(j,p){function M(q,t,i){t=t.dropShadow&&t.dropShadowSteps?+t.dropShadowSteps:0;if(c.support.boxShadow){q.css(c.support.boxShadow,(t===0?"0 0 ":"1px 1px ")+t+"px rgba(0,0,0,0.5)");return false}q=q.find("cluetip-drop-shadow");if(t==q.length)return q;
q.remove();q=[];for(i=0;i<t;)q[i++]='<div style="top:'+i+"px;left:"+i+'px;"></div>';return i=c(q.join("")).css({position:"absolute",backgroundColor:"#000",zIndex:S-1,opacity:0.1}).addClass("cluetip-drop-shadow").prependTo("#cluetip")}var d,g,r,w,u,N;if(typeof j=="object"){p=j;j=null}if(j=="destroy"){var O=this.data("cluetip");if(O){c(O.selector).remove();c.removeData(this,"title");c.removeData(this,"cluetip");return this.unbind(".cluetip")}}p=c.extend(true,{},c.cluetip.defaults,p||{});ca++;O=c.cluetip.backCompat?
"cluetip":"cluetip-"+ca;var Z="#"+O,x=c.cluetip.backCompat?"#":".",ja=/appendTo|prependTo|insertBefore|insertAfter/.test(p.insertionType)?p.insertionType:"appendTo",ka=p.insertionElement||"body";d=c(Z);if(!d.length){d=c(c.cluetip.template)[ja](ka).attr("id",O).css({position:"absolute",display:"none"});var S=+p.cluezIndex;r=d.find(x+"cluetip-outer").css({position:"relative",zIndex:S});g=d.find(x+"cluetip-inner");w=d.find(x+"cluetip-title")}B=c("#cluetip-waitimage");B.length||(B=c("<div></div>").attr("id",
"cluetip-waitimage").css({position:"absolute"}));B.insertBefore(d).hide();var la=(parseInt(d.css("paddingLeft"),10)||0)+(parseInt(d.css("paddingRight"),10)||0);this.each(function(q){function t(){return false}var i=this,e=c(this),a=c.extend(true,{},p,c.metadata?e.metadata():c.meta?e.data():{}),da=false,G=false,ea=0,m=e.attrProp(a.attribute),P=a.cluetipClass;S=+a.cluezIndex;e.data("cluetip",{title:i.title,zIndex:S,selector:Z});if(!m&&!a.splitTitle&&!j)return true;if(a.local&&a.localPrefix)m=a.localPrefix+
m;a.local&&a.hideLocal&&m&&c(m+":first").hide();var v=parseInt(a.topOffset,10),C=parseInt(a.leftOffset,10),D,$,T=isNaN(parseInt(a.height,10))?"auto":/\D/g.test(a.height)?a.height:a.height+"px",U,y,z,H,V,aa=parseInt(a.width,10)||275,n=aa+la+a.dropShadowSteps,F=this.offsetWidth,A,k,o,I,J,s=a.attribute!="title"?e.attrProp(a.titleAttribute):"";if(a.splitTitle){if(s==undefined)s="";J=s.split(a.splitTitle);s=J.shift()}if(a.escapeTitle)s=s.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;");
var X=function(b){if(a.onActivate(e)===false)return false;G=true;d=c(Z).css({position:"absolute"});r=d.find(x+"cluetip-outer");g=d.find(x+"cluetip-inner");w=d.find(x+"cluetip-title");u=d.find(x+"cluetip-arrows");d.removeClass().css({width:aa});m==e.attr("href")&&e.css("cursor",a.cursor);a.hoverClass&&e.addClass(a.hoverClass);y=e.offset().top;A=e.offset().left;F=e.innerWidth();if(b.type==focus){o=A+F/2+C;d.css({left:k});H=y+v}else{o=b.pageX;H=b.pageY}if(i.tagName.toLowerCase()!="area"){U=c(document).scrollTop();
I=c(window).width()}if(a.positionBy=="fixed"){k=F+A+C;d.css({left:k})}else{k=F>A&&A>n||A+F+n+C>I?A-n-C:F+A+C;if(i.tagName.toLowerCase()=="area"||a.positionBy=="mouse"||F+n>I)if(o+20+n>I){d.addClass(" cluetip-"+P);k=o-n-C>=0?o-n-C-parseInt(d.css("marginLeft"),10)+parseInt(g.css("marginRight"),10):o-n/2}else k=o+C;var f=k<0?b.pageY+v:b.pageY;d.css({left:k>0&&a.positionBy!="bottomTop"?k:o+n/2>I?I/2-n/2:Math.max(o-n/2,0),zIndex:e.data("cluetip").zIndex});u.css({zIndex:e.data("cluetip").zIndex+1})}$=c(window).height();
if(j){if(typeof j=="function")j=j.call(i);g.html(j);K(f)}else if(J){b=J.length;g.html(b?J[0]:"");if(b>1)for(var h=1;h<b;h++)g.append('<div class="split-body">'+J[h]+"</div>");K(f)}else if(!a.local&&m.indexOf("#")!==0)if(/\.(jpe?g|tiff?|gif|png)(?:\?.*)?$/i.test(m)){g.html('<img src="'+m+'" alt="'+s+'" />');K(f)}else{var l=a.ajaxSettings.beforeSend,fa=a.ajaxSettings.error,ga=a.ajaxSettings.success,ha=a.ajaxSettings.complete;b=c.extend(true,{},a.ajaxSettings,{cache:a.ajaxCache,url:m,beforeSend:function(E){l&&
l.call(i,E,d,g);r.children().empty();a.waitImage&&B.css({top:H+20,left:o+20,zIndex:e.data("cluetip").zIndex-1}).show()},error:function(E,Q){if(G)fa?fa.call(i,E,Q,d,g):g.html("<i>sorry, the contents could not be loaded</i>")},success:function(E,Q){da=a.ajaxProcess.call(i,E);if(G){ga&&ga.call(i,E,Q,d,g);g.html(da)}},complete:function(E,Q){ha&&ha.call(i,E,Q,d,g);var W=g[0].getElementsByTagName("img");L=W.length;for(var ba=0,ma=W.length;ba<ma;ba++)W[ba].complete&&L--;if(L&&!c.browser.opera)c(W).bind("load error",
function(){L--;if(L<1){B.hide();G&&K(f)}});else{B.hide();G&&K(f)}}});c.ajax(b)}else if(a.local){b=c(m+(/#\S+$/.test(m)?"":":eq("+q+")")).clone(true).show();a.localIdSuffix&&b.attr("id",b[0].id+a.localIdSuffix);g.html(b);K(f)}},K=function(b){var f,h,l="";h="";d.addClass("cluetip-"+P);if(a.truncate){f=g.text().slice(0,a.truncate)+"...";g.html(f)}s?w.show().html(s):a.showTitle?w.show().html("&nbsp;"):w.hide();if(a.sticky){f=c('<div class="cluetip-close"><a href="#">'+a.closeText+"</a></div>");a.closePosition==
"bottom"?f.appendTo(g):a.closePosition=="title"?f.prependTo(w):f.prependTo(g);f.bind("click.cluetip",function(){R();return false});a.mouseOutClose?d.bind("mouseleave.cluetip",function(){R()}):d.unbind("mouseleave.cluetip")}r.css({zIndex:e.data("cluetip").zIndex,overflow:T=="auto"?"visible":"auto",height:T});D=T=="auto"?Math.max(d.outerHeight(),d.height()):parseInt(T,10);z=y;V=U+$;if(a.positionBy=="fixed")z=y-a.dropShadowSteps+v;else if(k<o&&Math.max(k,0)+n>o||a.positionBy=="bottomTop")if(y+D+v>V&&
H-U>D+v){z=H-D-v;h="top"}else{z=H+v;h="bottom"}else z=y+D+v>V?D>=$?U:V-D-v:e.css("display")=="block"||i.tagName.toLowerCase()=="area"||a.positionBy=="mouse"?b-v:y-a.dropShadowSteps;if(h=="")k<A?h="left":h="right";f=" clue-"+h+"-"+P+" cluetip-"+P;if(P=="rounded")f+=" ui-corner-all";d.css({top:z+"px"}).attrProp({className:"cluetip ui-widget ui-widget-content ui-cluetip"+f});if(a.arrows){if(/(left|right)/.test(h)){h=d.height()-u.height();l=k>=0&&b>0?y-z-a.dropShadowSteps:0;l=h>l?l:h;l+="px"}u.css({top:l}).show()}else u.hide();
(N=M(d,a))&&N.length&&N.hide().css({height:D,width:aa,zIndex:e.data("cluetip").zIndex-1}).show();d.hide()[a.fx.open](a.fx.openSpeed||0);c.fn.bgiframe&&d.bgiframe();if(a.delayedClose>0)ea=setTimeout(R,a.delayedClose);a.onShow.call(i,d,g)},Y=function(){G=false;B.hide();if(!a.sticky||/click|toggle/.test(a.activation)){R();clearTimeout(ea)}a.hoverClass&&e.removeClass(a.hoverClass)},R=function(b){b=b&&b.data("cluetip")?b:e;var f=b.data("cluetip").selector;f=c(f);var h=f.find(x+"cluetip-inner"),l=f.find(x+
"cluetip-arrows");f.hide().removeClass();a.onHide.call(b[0],f,h);b.removeClass("cluetip-clicked");s&&b.attrProp(a.titleAttribute,s);b.css("cursor","");a.arrows&&l.css({top:""})};c(document).unbind("hideCluetip.cluetip").bind("hideCluetip.cluetip",function(b){R(c(b.target))});if(/click|toggle/.test(a.activation))e.bind("click.cluetip",function(b){if(d.is(":hidden")||!e.is(".cluetip-clicked")){X(b);c(".cluetip-clicked").removeClass("cluetip-clicked");e.addClass("cluetip-clicked")}else Y(b);return false});
else if(a.activation=="focus"){e.bind("focus.cluetip",function(b){e.attrProp("title","");X(b)});e.bind("blur.cluetip",function(b){e.attrProp("title",e.data("cluetip").title);Y(b)})}else{e[a.clickThrough?"unbind":"bind"]("click.cluetip",t);var ia=function(b){if(a.tracking==true){var f=k-b.pageX,h=z?z-b.pageY:y-b.pageY;e.bind("mousemove.cluetip",function(l){d.css({left:l.pageX+f,top:l.pageY+h})})}};c.fn.hoverIntent&&a.hoverIntent?e.hoverIntent({sensitivity:a.hoverIntent.sensitivity,interval:a.hoverIntent.interval,
over:function(b){X(b);ia(b)},timeout:a.hoverIntent.timeout,out:function(b){Y(b);e.unbind("mousemove.cluetip")}}):e.bind("mouseenter.cluetip",function(b){X(b);ia(b)}).bind("mouseleave.cluetip",function(b){Y(b);e.unbind("mousemove.cluetip")});e.bind("mouseover.cluetip",function(){e.attrProp("title","")}).bind("mouseleave.cluetip",function(){e.attrProp("title",e.data("cluetip").title)})}});return this};(function(){c.support=c.support||{};for(var j=document.createElement("div").style,p=["boxShadow"],
M=["moz","Moz","webkit","o"],d=0,g=p.length;d<g;d++){var r=p[d],w=r.charAt(0).toUpperCase()+r.slice(1);if(typeof j[r]!=="undefined")c.support[r]=r;else for(var u=0,N=M.length;u<N;u++)if(typeof j[M[u]+w]!=="undefined"){c.support[r]=M[u]+w;break}}})();c.fn.cluetip.defaults=c.cluetip.defaults})(jQuery);
